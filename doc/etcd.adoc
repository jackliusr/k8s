= etcd cluster operation

Env:  labs/etcd

== create cluster

=== single node cluster

https://etcd.io/docs/v3.2.17/op-guide/container/#running-a-single-node-etcd-1

[source, bash]
----
docker network create --subnet "172.20.0.0/16"   etcd 
export NODE1=172.20.1.1
docker run \
  --rm \
  --name node1  \
  --network=etcd \
  --ip=172.20.1.1 \
   quay.io/coreos/etcd:v3.4.14 \
   /usr/local/bin/etcd \
  --data-dir=/etcd-data --name node1 \
  --initial-advertise-peer-urls http://${NODE1}:2380 \
  --listen-peer-urls http://${NODE1}:2380,http://localhost:2380 \
  --advertise-client-urls http://${NODE1}:2379,http://localhost:2379 \
  --listen-client-urls http://${NODE1}:2379,http://localhost:2379 \
  --initial-cluster node1=http://${NODE1}:2380
----

=== 3 node cluster

"docker-compose docker-compose.yaml up" will launch a 3 nodes etcd cluster.

3node-etcd.yaml can be used to launch a ready environment to practice static way

[source,bash ]
----
etcd --name etcd1 --initial-advertise-peer-urls http://etcd1:2380 \
  --listen-peer-urls http://0.0.0.0:2380   \
  --listen-client-urls http://0.0.0.0:2379   \
  --advertise-client-urls http://etcd1:2379   \
  --initial-cluster-token etcd-cluster-1   \
  --initial-cluster etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380   \
  --initial-cluster-state new



etcd --name etcd2  \
	--initial-advertise-peer-urls http://etcd2:2380    \
	--listen-peer-urls http://0.0.0.0:2380    \
	--listen-client-urls http://0.0.0.0:2379    \
	--advertise-client-urls http://etcd2:2379    \
	--initial-cluster-token etcd-cluster-1    \
	--initial-cluster etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380    \
	--initial-cluster-state new 



etcd --name etcd3  \
--initial-advertise-peer-urls http://etcd3:2380    \
--listen-peer-urls http://0.0.0.0:2380    \
--listen-client-urls http://0.0.0.0:2379    \
--advertise-client-urls http://etcd3:2379    \
--initial-cluster-token etcd-cluster-1    \
--initial-cluster etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380    \
--initial-cluster-state new

----

=== Backup and Recover

=== Add and Remove nodes
